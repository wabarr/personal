---
layout: post
title: faster for() loops in R
date: '2013-11-13T11:57:00.003-06:00'
author: Andrew Barr
tags:
- R Tips
modified_time: '2013-11-14T08:26:51.541-06:00'
blogger_id: tag:blogger.com,1999:blog-9204176314411862946.post-4168005868861576679
blogger_orig_url: http://www.ancienteco.com/2013/11/faster-for-loops-in-r.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px;">One of the most common ways people write</span><span style="background-color: white; color: #222222; font-size: 13px;"><span style="font-family: Courier New, Courier, monospace;"> for() </span></span><span style="background-color: white;"><span style="color: #222222; font-family: arial, sans-serif; font-size: 13px;">loops is to create an empty results vector and then concatenate each result with the previous (and growing) results vector, like the&nbsp;following. &nbsp;(Note: wrapping an expression in&nbsp;the function </span></span><span style="background-color: white; color: #222222; font-size: 13px;"><span style="font-family: Courier New, Courier, monospace;">system.time() </span></span><span style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px;">executes the function and returns a summary of how long it took, in seconds.)</span><br /><div style="background-color: white; color: #222222; font-family: arial, sans-serif; font-size: 13px;"><div><br /></div><div><div><span style="font-family: courier new, monospace;">x &lt;- c()</span></div><div><span style="font-family: courier new, monospace;">system.time(</span></div><div><span style="font-family: courier new, monospace;">&nbsp; for(i in 1:40000){</span></div><div><span style="font-family: courier new, monospace;">&nbsp; &nbsp; x&lt;-c(x,i) #here i is combined with previous contents of x</span></div><div><span style="font-family: courier new, monospace;">&nbsp; }</span></div><div><span style="font-family: courier new, monospace;">)</span></div><div><span style="font-family: courier new, monospace;"><br /></span></div><div><div><span style="font-family: courier new, monospace;">&nbsp; &nbsp;user &nbsp;system elapsed&nbsp;</span></div><div><span style="font-family: courier new, monospace;">&nbsp; 2.019 &nbsp; 0.082 &nbsp; 2.100&nbsp;</span></div></div></div><div><br /></div><div>It is MUCH faster to create the results an empty vector of the correct size, and modify elements in place. &nbsp;This prevents R from having to move around an ever growing object in memory and is much faster. In short....it seems that what R is slow at is allocating memory for objects.</div><div><br /></div><div><div><span style="font-family: courier new, monospace;">x&lt;-numeric(40000) #empty numeric vector</span></div><div><span style="font-family: courier new, monospace;">system.time(</span></div><div><span style="font-family: courier new, monospace;">&nbsp; for(i in 1:40000){</span></div><div><span style="font-family: courier new, monospace;">&nbsp; &nbsp; x[i] &lt;- i #changing value of particular element of x</span></div><div><span style="font-family: courier new, monospace;">&nbsp; }</span></div><div><span style="font-family: courier new, monospace;">)</span></div></div><div><div><span style="font-family: courier new, monospace;">&nbsp; &nbsp;user &nbsp;system elapsed&nbsp;</span></div><div><span style="font-family: courier new, monospace;">&nbsp; 0.066 &nbsp; 0.001 &nbsp; 0.067&nbsp;</span></div></div><div><br /></div><div>The second method is over 31 times faster on my machine.</div><div><br /></div><div>PS. &nbsp;This post was inspired by Hadley Wickham's much more technical and <a href="http://adv-r.had.co.nz/memory.html">in-depth coverage of memory usage in R.</a></div></div></div>