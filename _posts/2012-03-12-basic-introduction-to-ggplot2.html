---
layout: post
title: Basic Introduction to ggplot2
date: '2012-03-12T12:21:00.002-05:00'
author: Andrew Barr
tags:
- ggplot2
- R Tips
modified_time: '2012-10-10T09:14:07.160-05:00'
thumbnail: http://1.bp.blogspot.com/-83J_6bvtaNI/Ts--12sI61I/AAAAAAAAIJs/avUtn-8Y17M/s72-c/BMHistogram.jpg
blogger_id: tag:blogger.com,1999:blog-9204176314411862946.post-8982604086472904435
blogger_orig_url: http://www.ancienteco.com/2012/03/basic-introduction-to-ggplot2.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><b>This is a very basic introduction to the ggplot2 package.&nbsp; A much more detailed description of the package can be found in this book <a href="http://www.amazon.com/ggplot2-Elegant-Graphics-Data-Analysis/dp/0387981403">ggplot2: Elegant Graphics for Data Analysis</a>. </b><br /><br />On his website (<a href="http://had.co.nz/ggplot2/">http://had.co.nz/ggplot2/</a>) package author Hadley Wickham describes ggplot2 as<br /><blockquote class="tr_bq">a plotting system for R, based on the grammar of graphics,  which tries to take the good parts of base and lattice graphics and none  of the bad parts. It takes care of many of the fiddly details that make  plotting a hassle (like drawing legends) as well as providing a  powerful model of graphics that makes it easy to produce complex  multi-layered graphics.</blockquote><span style="font-family: Times,&quot;Times New Roman&quot;,serif;">There are two major functions that you will use in ggplot2 </span><br /><ul><li><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">qplot()</span> - for quick plots&nbsp;</li><li><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ggplot()</span> - for fine, granular control of everything (not going to get into this in this post)</li></ul>Lets start with <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">qplot()</span> to see how easy and pretty things can be with ggplot2.<br /><br /><a name='more'></a><br /><span style="font-size: small;"><b style="font-family: Times,&quot;Times New Roman&quot;,serif;">Importing Data and Loading Package</b></span><br /><span style="font-size: small;">Lets play around with a published dataset of measurements taken on antelope leg bones.&nbsp; The data come from this paper. </span><br /><blockquote class="tr_bq"><span style="font-size: small;">DeGusta  D, and Vrba E. 2003. A method for inferring paleohabitats from the  functional morphology of bovid astragali. Journal of Archaeological  Science 30:1009â€“1022 </span></blockquote>For simplicity's sake, I took out a bunch of columns that we don't need. If you are actually interested in the data themselves, you should examine the paper itself to find all the data that I took out.<br />&nbsp; <br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">#load the package</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">library(ggplot2)</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;"><br /></span></div><div><span style="font-family: 'Courier New', Courier, monospace; font-size: small;"><br /></span><span style="font-family: Times, Times New Roman, serif;">We are going to use a nice trick here and read the text file from directly from a remote url. </span><br /><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;"><br /></span></div></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">filepath&lt;-"http://bit.ly/wBBTQO"</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">#read in the tab delimited text file using the url() function </span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">myData&lt;-read.table(file=url(filepath),header=T,sep="\t")</span></div><div><span style="font-family: 'Courier New', Courier, monospace; font-size: small;"><br /></span><span style="font-size: small;"><span style="font-family: Times, Times New Roman, serif;">Now we can look at the structure of the dataframe we just imported.</span></span><br /><div style="font-family: 'Courier New', Courier, monospace;"><br /></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;">str(myData)</span></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;">'data.frame':&nbsp;&nbsp;&nbsp; 218 obs. of&nbsp; 4 variables:<br />&nbsp;$ Tribe : Factor w/ 8 levels "Aepycerotini",..: 1 1 1 1 1 1 1 1 1 1 ...<br />&nbsp;$ Hab&nbsp;&nbsp; : Factor w/ 4 levels "F","H","L","O": 3 3 3 3 3 3 3 3 3 3 ...<br />&nbsp;$ BM&nbsp;&nbsp;&nbsp; : num&nbsp; 56.2 56.2 56.2 56.2 56.2 ...<br />&nbsp;$ var1&nbsp; : num&nbsp; 36.5 40.9 37 36.2 36.6 37.7 37.3 39 37.7 35.3 ...</span></div><span style="font-family: 'Courier New', Courier, monospace; font-size: small;"><br /></span><span style="font-size: small;"><span style="font-family: Times, Times New Roman, serif;">You can see that there are 218 rows, each representing an individual antelope. The dataset has 2 factors (categorical variables), one recording the taxonomic tribe of the specimen, and one recording what type if habitat the individual occupies.&nbsp; Then there are 2 continuous variables: BM is average species body mass and var1 is a measurement of the leg-bone.</span></span><br /><div style="font-family: 'Courier New', Courier, monospace;"><br /></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;"><b style="font-family: Times,&quot;Times New Roman&quot;,serif;">A simple histogram in ggplot2</b></span></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-family: Times,&quot;Times New Roman&quot;,serif; font-size: small;">For  a histogram, all we need to tell <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">qplot()</span>is which dataframe to look in  and which variable is on the x axis.&nbsp; I also added in a plot title with  the "main=" argument. Pretty easy!</span></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;">qplot(data=myData,x=BM,main="Histogram of BodyMass")</span></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;"><br /></span></div><div class="separator" style="clear: both; font-family: 'Courier New', Courier, monospace; text-align: center;"><a href="http://1.bp.blogspot.com/-83J_6bvtaNI/Ts--12sI61I/AAAAAAAAIJs/avUtn-8Y17M/s1600/BMHistogram.jpg" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="320" src="http://1.bp.blogspot.com/-83J_6bvtaNI/Ts--12sI61I/AAAAAAAAIJs/avUtn-8Y17M/s400/BMHistogram.jpg" width="400" /></a></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;"><b style="font-family: Times,&quot;Times New Roman&quot;,serif;"> </b></span></div><div style="font-family: 'Courier New', Courier, monospace;"><br /></div><div style="font-family: 'Courier New', Courier, monospace;"><span style="font-size: small;"><b style="font-family: Times,&quot;Times New Roman&quot;,serif;">A basic scatterplot</b></span></div></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Times,&quot;Times New Roman&quot;,serif; font-size: small;">Lets  say I want to plot a variable against body mass, color coded by  taxonomic tribe. <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">qplot()</span> works just like regular <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">plot()</span> only much  smarter.&nbsp; For instance, you tell qplot to do the color coding with a  single argument "color=Tribe". Note also that I indicate I want to log  both variables with the log="xy" argument. Note further: the legend is  handled AUTOMATICALLY BY DEFAULT! If you have done a lot of graphing in R  previously then your mouth is right now hanging open in astonishment.&nbsp;  And the default graph is beautiful!</span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">qplot(data=myData,x=BM,y=var1,log="xy",color=Tribe)</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-ko7p70PJfQI/T14nSB9L97I/AAAAAAAAItg/gZ5tjxW0TZM/s1600/var1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-ko7p70PJfQI/T14nSB9L97I/AAAAAAAAItg/gZ5tjxW0TZM/s400/var1.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: small;"><a href="http://3.bp.blogspot.com/-w5FTYmxx-Vw/Ts-1IlcUITI/AAAAAAAAIJU/3gwUsHxFBMA/s1600/LI%257EBM.jpg" style="margin-left: 1em; margin-right: 1em;"><br /></a></span></div>NOTE: The appearance of these log-scales reflects the new default in the new version of ggplot2, which was just published on CRAN  2012-03-01. I personally prefer the old log-scale default, where tick bars were evenly spaced, but I haven't figured out how to change this behavior yet.<br /><br />UPDATE: to get a plot like the former default plot, simply transform the variables yourself in the call, and take out the log="xy" part, like the following:<br /><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">qplot(data=myData,x=log(BM),y=log(var1),color=Tribe)</span></div><br /><span style="font-size: small;"><b>Boxplots - changing the geom</b></span><br /><span style="font-size: small;">OK,  now lets say that I want to see how the raw values of that same  variable are distributed over different habitat types.&nbsp; I could just do  this: (graph not shown)</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace; font-size: small;">qplot(data=myData,x=Hab,y=var1)</span><br /><br /><span style="font-size: small;">It  works, but we probably don't want to represent the data as points (the  default), but rather by a boxplot. We tell qplot() this by setting the  argument "geom=".&nbsp; Geom means "geometric object" and it tells qplot()  how to represent the data, and <a href="http://had.co.nz/ggplot2/">there are many options</a>. To get a boxplot, we just tell it geom="boxplot".</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace; font-size: small;">qplot(data=myData,x=Hab,y=var1,geom="boxplot")</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-idxmbOHLitU/T14o-aL1yXI/AAAAAAAAIto/4KxZSM-EHYw/s1600/var1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-idxmbOHLitU/T14o-aL1yXI/AAAAAAAAIto/4KxZSM-EHYw/s400/var1.jpg" width="400" /></a></div><br /><br /><div class="separator" style="clear: both; text-align: center;"><span style="font-size: small;"></span></div><span style="font-size: small;">Also, you could try the "jitter" geom, I kind of think works better than boxplots sometimes. (Go ahead....try it!)</span><br /><br /><span style="font-size: small;"><b>Doing the same thing to different data subsets - Faceting</b></span><br /><span style="font-size: small;">It  is extremely common to want to do the same type of plot for different  subsets of your data (i.e. based on the values of some factor, aka a  categorical variable). <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">qplot()</span> makes this amazingly easy by providing a  "facets=" argument.</span><br /><br /><span style="font-size: small;">Going back to  our first scatterplot, we can plot the relationship between our  variable and BM for each taxonomic tribe, with each tribe separated into  the various habitat categories.&nbsp; We simply add one argument to do this  "facets = Hab~Tribe".&nbsp; Note the use of the "~" character.&nbsp; This is  because you are passing a <b>formula</b> to the facets argument.&nbsp; It will do the same plot for every unique level of the factors you tell it.</span><br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;">qplot(data=myData,x=BM,y=var1,log="xy",color=Tribe,facets = Hab~Tribe)</span></div><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-V5EKFBe8r8Y/T14vn6wzCGI/AAAAAAAAItw/IzKs5oWk-6U/s1600/Rplot.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="212" src="http://1.bp.blogspot.com/-V5EKFBe8r8Y/T14vn6wzCGI/AAAAAAAAItw/IzKs5oWk-6U/s400/Rplot.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: small;"><a href="http://2.bp.blogspot.com/-QojC6yMls4E/Ts_AJQ9UXpI/AAAAAAAAIJ0/wntpw59mGus/s1600/LIBMFacets.jpg" style="margin-left: 1em; margin-right: 1em;"><br /></a></span></div><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><div style="font-family: Times,&quot;Times New Roman&quot;,serif;"><br /></div><div style="font-family: Times,&quot;Times New Roman&quot;,serif;"><span style="font-size: small;">This  isn't actually very useful in this case because there are a lot of empty factor  levels.&nbsp; I probably just want to do it for each tribe like this. Note  you still need the "~".</span></div><span style="font-size: small;">qplot(data=myData,x=BM,y=var1,log="xy",color=Tribe,facets = ~Tribe)</span><br /><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-3Rk9aGYuJDE/T14v9Unx1_I/AAAAAAAAIt4/YoUC_D4ZvFM/s1600/var1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://2.bp.blogspot.com/-3Rk9aGYuJDE/T14v9Unx1_I/AAAAAAAAIt4/YoUC_D4ZvFM/s400/var1.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><span style="font-size: small;"><a href="http://4.bp.blogspot.com/-JrYvqAtukmE/Ts-zPVpXRyI/AAAAAAAAIJM/3p3XrrCtb7A/s1600/LI%257EBMFaceted.jpg" style="margin-left: 1em; margin-right: 1em;"><br /></a></span></div><span style="font-size: small;"><br /></span><span style="font-size: small;"><b>Trend lines - adding statistical transformation layers. </b></span><br />We  probably want to add a trend line to each plot as well.&nbsp; In ggplot2,  you think of a plot as made up of different layers.&nbsp; A trendline is a  statistical transformation layer that is overlaid on the graph.&nbsp; The  easiest way to do this is to use qplot() to recreate the exact plot we  just made, only this time instead of plotting it, we save it in a  variable to do further stuff to it.&nbsp; <br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">myGG&lt;-qplot(data=myData,x=BM,y=var1,color=Tribe,facets=~Tribe)</span><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;</span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-family: Times,&quot;Times New Roman&quot;,serif;">Then  we can ADD A LAYER to this object in which we add a smoothing statistic  using "method='lm'" to add an ordinary least squares trendline.&nbsp; We  could do other smoothing functions like LOESS, among others.&nbsp; The  function stat_smooth() creates a statistical transformation layer that  can be added to our existing plot. To add it we....literally.....just  add it.</span></span><br /><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">myGG&lt;- myGG + stat_smooth(method="lm")</span><br /><br />Now,  to plot a ggplot2 object all you have to do is type its name. By  default, it plots itself to the graphics device. It is kind of hard to  see here, but by default all ggplot trend lines show confidence  intervals as gray areas surrounding the line....nice!<br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">myGG</span><br /><span style="font-family: &quot;Courier New&quot;,Courier,monospace;">&nbsp;</span> <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-pDzse5ixbCg/T14wSKWZ1ZI/AAAAAAAAIuA/n3-boYMlrXg/s1600/var1.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="400" src="http://4.bp.blogspot.com/-pDzse5ixbCg/T14wSKWZ1ZI/AAAAAAAAIuA/n3-boYMlrXg/s400/var1.jpg" width="400" /></a></div><div class="separator" style="clear: both; text-align: center;"><br /></div><b>As if that wasn't enough - saving graphs to file is a snap with ggsave()</b><br />ggplot2  comes with a great function called <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ggsave()</span> that takes all the headache  out of exporting graphics from R. The only required parameter is a  filename, like so. <br /><div style="font-family: &quot;Courier New&quot;,Courier,monospace;">ggsave("LIBMFacetsWithTrend.jpg")</div><br />BY  DEFAULT, it detects the desired format based on the file extension you  give it and handles everything silently and efficiently.&nbsp; Again...<span style="font-family: Times,&quot;Times New Roman&quot;,serif; font-size: small;">If you have done a lot of graphing in R previously then your mouth is right now hanging open in astonishment.</span> The default behavior is to save the last ggplot object that you plotted  to the graphic device, but of course you can pass it the name of any  saved ggplot object.&nbsp; You can also of course change things like output  dimensions and DPI, etc.&nbsp; Just have a look at ?ggsave</div>