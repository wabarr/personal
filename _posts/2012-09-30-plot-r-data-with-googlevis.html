---
layout: post
title: Plot R Data With googleVis
date: '2012-09-30T09:23:00.000-05:00'
author: Andrew Barr
tags:
- googleVis
- R Tips
modified_time: '2012-10-05T08:42:27.181-05:00'
blogger_id: tag:blogger.com,1999:blog-9204176314411862946.post-3594769887201619755
blogger_orig_url: http://www.ancienteco.com/2012/09/plot-r-data-with-googlevis.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on">Here is a little code snippet that shows how to do two things<br /><br /><ol style="text-align: left;"><li>Use the Google Maps API to resolve place names into lat-long coordinate pairs.</li><li>Plot R dataframes that contain lat-long data (for example from #1) onto Google Maps for quick visualization using the googleVis package. &nbsp;The embedded map looks a little wonky here but it looks perfectly normal when you plot it locally in your browser. (Note: you need an internet connection for these maps to plot properly).&nbsp;</li></ol></div><!-- Map generated in R 2.14.1 by googleVis 0.2.15 package --><!-- Sun Sep 30 15:26:11 2012 -->  <!-- jsHeader --><script src="http://www.google.com/jsapi" type="text/javascript"></script><script type="text/javascript">  // jsData  function gvisDataMapID71b85742e7 () {   var data = new google.visualization.DataTable();   var datajson = [  [   44.9366667,   1.0180556, "Cro Magnon"  ], [    44.953496,    0.942001, "La Ferrassie"  ], [    45.746021,    5.968865, "Chauvet Cave"  ], [    44.987241,    1.725199, "La Chapelle aux Saints"  ], [    44.994137,    1.058667, "Le Moustier"  ]  ]; data.addColumn('number','Latitude'); data.addColumn('number','Longitude'); data.addColumn('string','name'); data.addRows(datajson); return(data); }   // jsDrawChart function drawChartMapID71b85742e7() {   var data = gvisDataMapID71b85742e7();   var options = {}; options["showTip"] = true; options["mapType"] = "normal";       var chart = new google.visualization.Map(        document.getElementById('MapID71b85742e7')      );      chart.draw(data,options);       }      // jsDisplayChart  function displayChartMapID71b85742e7() {   google.load("visualization", "1", { packages:["map"] });    google.setOnLoadCallback(drawChartMapID71b85742e7); }   // jsChart  displayChartMapID71b85742e7()   <!-- jsFooter </script>   //--&gt; </div>--&gt;   <!-- divChart -->   <br /><div id="MapID71b85742e7" style="height: 500px; width: 600px;"></div><div>Data: plotData • Chart ID: <a href="http://www.blogger.com/Chart_MapID71b85742e7.html">MapID71b85742e7</a><br /><!-- htmlFooter -->  R version 2.14.1 (2011-12-22) • <a href="http://code.google.com/p/google-motion-charts-with-r/">googleVis-0.2.15</a>• <a href="http://code.google.com/apis/terms/index.html">Google Terms of Use</a> • <a href="http://code.google.com/apis/chart/interactive/docs/gallery/map.html#Data_Policy">Data Policy</a></div><div style="overflow: auto;"><div class="geshifilter"><pre class="r geshifilter-R" style="font-family: monospace;"><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/XML">XML</a><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/base/require"><span style="color: #003399; font-weight: bold;">require</span></a><span style="color: #009900;">(</span>googleVis<span style="color: #009900;">)</span><br />&nbsp;<br />&nbsp;<br /><span style="color: #666666; font-style: italic;">####functions borrwed from <a href="http://statisfaction.wordpress.com/2011/10/05/calling-google-maps-api-from-r/">http://statisfaction.wordpress.com/2011/10/05/calling-google-maps-api-from-r/</a></span><br />&nbsp;<br />getDocNodeVal=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>doc<span style="color: #339933;">,</span> path<span style="color: #009900;">)</span><br /><span style="color: #009900;">{</span><br />   <a href="http://inside-r.org/r-doc/base/sapply"><span style="color: #003399; font-weight: bold;">sapply</span></a><span style="color: #009900;">(</span>getNodeSet<span style="color: #009900;">(</span>doc<span style="color: #339933;">,</span> path<span style="color: #009900;">)</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>el<span style="color: #009900;">)</span> xmlValue<span style="color: #009900;">(</span>el<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br />gGeoCode=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">)</span><br /><span style="color: #009900;">{</span><br />  <a href="http://inside-r.org/r-doc/base/library"><span style="color: #003399; font-weight: bold;">library</span></a><span style="color: #009900;">(</span><a href="http://inside-r.org/packages/cran/XML">XML</a><span style="color: #009900;">)</span><br />  u=<a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span><span style="color: blue;">'http://maps.google.com/maps/api/geocode/xml?sensor=false&amp;address='</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">)</span><br />  doc = xmlTreeParse<span style="color: #009900;">(</span>u<span style="color: #339933;">,</span> useInternal=<span style="color: black; font-weight: bold;">TRUE</span><span style="color: #009900;">)</span><br />  <a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a>=<a href="http://inside-r.org/r-doc/base/gsub"><span style="color: #003399; font-weight: bold;">gsub</span></a><span style="color: #009900;">(</span><span style="color: blue;">' '</span><span style="color: #339933;">,</span><span style="color: blue;">'%20'</span><span style="color: #339933;">,</span><a href="http://inside-r.org/r-doc/utils/str"><span style="color: #003399; font-weight: bold;">str</span></a><span style="color: #009900;">)</span><br />  lat=getDocNodeVal<span style="color: #009900;">(</span>doc<span style="color: #339933;">,</span> <span style="color: blue;">"/GeocodeResponse/result/geometry/location/lat"</span><span style="color: #009900;">)</span><br />  lng=getDocNodeVal<span style="color: #009900;">(</span>doc<span style="color: #339933;">,</span> <span style="color: blue;">"/GeocodeResponse/result/geometry/location/lng"</span><span style="color: #009900;">)</span><br />  <a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">(</span>lat = lat<span style="color: #339933;">,</span> lng = lng<span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#### End functions borrowed from <a href="http://statisfaction.wordpress.com/2011/10/05/calling-google-maps-api-from-r/">http://statisfaction.wordpress.com/2011/10/05/calling-google-maps-api-from-r/</a></span><br />&nbsp;<br /># get some names of paleoanthropological sites in France. <br />placeNames&lt;-<a href="http://inside-r.org/r-doc/base/c"><span style="color: #003399; font-weight: bold;">c</span></a><span style="color: #009900;">(</span><span style="color: blue;">"Cro Magnon"</span><span style="color: #339933;">,</span><span style="color: blue;">"La Ferrassie"</span><span style="color: #339933;">,</span><span style="color: blue;">"Chauvet Cave"</span><span style="color: #339933;">,</span><span style="color: blue;">"La Chapelle aux Saints"</span><span style="color: #339933;">,</span> <span style="color: blue;">"Le Moustier"</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#resolve the placenames into latlong</span><br />latLong&lt;-<a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a><span style="color: #009900;">(</span>placeNames<span style="color: #339933;">,</span> FUN=gGeoCode<span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#format the latlong coordinates into the proper format lat:long</span><br />latLongFormatted&lt;-<a href="http://inside-r.org/r-doc/base/lapply"><span style="color: #003399; font-weight: bold;">lapply</span></a><span style="color: #009900;">(</span>latLong<span style="color: #339933;">,</span>FUN=<a href="http://inside-r.org/r-doc/base/function"><span style="color: #003399; font-weight: bold;">function</span></a><span style="color: #009900;">(</span>x<span style="color: #009900;">)</span><span style="color: #009900;">{</span><br /> <a href="http://inside-r.org/r-doc/base/paste"><span style="color: #003399; font-weight: bold;">paste</span></a><span style="color: #009900;">(</span>x$lat<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>x$lng<span style="color: #009900;">[</span><span style="color: #cc66cc;">1</span><span style="color: #009900;">]</span><span style="color: #339933;">,</span>sep=<span style="color: blue;">":"</span><span style="color: #009900;">)</span><br /><span style="color: #009900;">}</span><span style="color: #009900;">)</span><br />&nbsp;<br /><span style="color: #666666; font-style: italic;">#create a dataframe, formatting the place name string first and making the latlong a vector, not list</span><br />plotData&lt;-<a href="http://inside-r.org/r-doc/base/data.frame"><span style="color: #003399; font-weight: bold;">data.frame</span></a><span style="color: #009900;">(</span>name=placeNames<span style="color: #339933;">,</span>latlong=<a href="http://inside-r.org/r-doc/base/unlist"><span style="color: #003399; font-weight: bold;">unlist</span></a><span style="color: #009900;">(</span>latLongFormatted<span style="color: #009900;">)</span><span style="color: #009900;">)</span><br />&nbsp;<br />sites&lt;-gvisMap<span style="color: #009900;">(</span>plotData<span style="color: #339933;">,</span>locationvar=<span style="color: blue;">"latlong"</span><span style="color: #339933;">,</span>tipvar=<span style="color: blue;">"name"</span><span style="color: #339933;">,</span> <a href="http://inside-r.org/r-doc/base/options"><span style="color: #003399; font-weight: bold;">options</span></a>=<a href="http://inside-r.org/r-doc/base/list"><span style="color: #003399; font-weight: bold;">list</span></a><span style="color: #009900;">(</span>mapType=<span style="color: blue;">'normal'</span><span style="color: #009900;">)</span><span style="color: #009900;">)</span><br /><a href="http://inside-r.org/r-doc/graphics/plot"><span style="color: #003399; font-weight: bold;">plot</span></a><span style="color: #009900;">(</span>sites<span style="color: #009900;">)</span></pre></div></div><a href="http://www.inside-r.org/pretty-r" title="Created by Pretty R at inside-R.org">Created by Pretty R at inside-R.org</a></div>